<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subir Beat - OFFSZN</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="beats.css">
</head>

<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="logo"><a href="../dashboard.html">OFFSZN</a></div>

        <div class="navbar-center">
            <ul class="navbar-links">
                <li><a href="../dashboard.html">INICIO</a></li>
                <li>
                    <a>RECURSOS <i class="fas fa-chevron-down"></i></a>
                    <div class="dropdown-menu">
                        <a href="../../beats.html" class="dropdown-item">
                            <i class="fas fa-music"></i>
                            <span>Beats & Instrumentales</span>
                        </a>
                        <a href="../../drum-kits.html" class="dropdown-item">
                            <i class="fas fa-drum"></i>
                            <span>Drum Kits</span>
                        </a>
                        <a href="../../presets.html" class="dropdown-item">
                            <i class="fas fa-sliders-h"></i>
                            <span>Presets & Plugins</span>
                        </a>
                        <a href="../../samples.html" class="dropdown-item">
                            <i class="fas fa-wave-square"></i>
                            <span>Samples & Loops</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="../../free-resources.html" class="dropdown-item">
                            <i class="fas fa-gift"></i>
                            <span>Recursos Gratis</span>
                        </a>
                    </div>
                </li>
                <li>
                    <a>COMUNIDAD <i class="fas fa-chevron-down"></i></a>
                    <div class="dropdown-menu">
                        <a href="../feed.html" class="dropdown-item">
                            <i class="fas fa-home"></i>
                            <span>Feed</span>
                        </a>
                        <a href="../../productores.html" class="dropdown-item">
                            <i class="fas fa-users"></i>
                            <span>Productores</span>
                        </a>
                        <a href="../colaboraciones.html" class="dropdown-item">
                            <i class="fas fa-handshake"></i>
                            <span>Colaboraciones</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="../../foros.html" class="dropdown-item">
                            <i class="fas fa-comments"></i>
                            <span>Foros</span>
                        </a>
                        <a href="../../eventos.html" class="dropdown-item">
                            <i class="fas fa-calendar"></i>
                            <span>Eventos</span>
                        </a>
                    </div>
                </li>
            </ul>

            <div class="navbar-search">
                <input type="text" placeholder="Buscar beats, kits, productores...">
                <i class="fas fa-search"></i>
            </div>
        </div>

        <div class="navbar-right">
            <a href="../notifications.html" class="navbar-icon-button"><i class="fas fa-bell"></i></a>
            <a href="../../cart.html" class="navbar-icon-button"><i class="fas fa-shopping-cart"></i></a>
            <div class="user-dropdown">
                <div class="navbar-icon-button" onclick="toggleUserDropdown()"><i class="fas fa-user"></i></div>
                <div class="user-dropdown-menu">
                    <div class="user-dropdown-header">
                        <div class="user-dropdown-avatar">U</div>
                        <div class="user-dropdown-info">
                            <div class="user-dropdown-name">Usuario</div>
                            <div class="user-dropdown-email">usuario@offszn.com</div>
                        </div>
                    </div>
                    <a href="../profile.html" class="user-dropdown-item"><i class="fas fa-user-circle"></i><span>Mi
                            Perfil</span></a>
                    <a href="../dashboard.html" class="user-dropdown-item"><i
                            class="fas fa-th-large"></i><span>Dashboard</span></a>
                    <a href="../wallet.html" class="user-dropdown-item"><i
                            class="fas fa-wallet"></i><span>Billetera</span></a>
                    <a href="../account-settings.html" class="user-dropdown-item"><i
                            class="fas fa-cog"></i><span>Configuración</span></a>
                    <a href="../logout.html" class="user-dropdown-item logout"><i
                            class="fas fa-sign-out-alt"></i><span>Cerrar Sesión</span></a>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">Subir Beat</h1>
            <p class="page-subtitle">Comparte tu música con miles de artistas alrededor del mundo</p>
        </div>

        <form id="uploadForm">
            <!-- INFORMACIÓN BÁSICA -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon"><i class="fas fa-music"></i></div>
                    <h2 class="section-title">Información Básica</h2>
                </div>

                <div class="basic-info-layout">
                    <div class="artwork-upload">
                        <div class="artwork-preview-container" id="artworkContainer"
                            onclick="document.getElementById('artworkInput').click()">
                            <img id="artworkImg" class="artwork-img" style="display: none;" alt="Portada">
                            <div class="artwork-placeholder" id="artworkPlaceholder">
                                <i class="fas fa-image"></i>
                                <div class="artwork-placeholder-text">Subir Portada</div>
                                <div class="artwork-placeholder-hint">JPG, PNG o WEBP (máx. 5MB)</div>
                            </div>
                            <button type="button" class="remove-artwork-btn" onclick="removeArtwork(event)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <input type="file" id="artworkInput" style="display: none;"
                            accept="image/jpeg,image/png,image/webp">
                    </div>

                    <div class="basic-info-fields">
                        <div class="form-group">
                            <label class="form-label">
                                Título del Beat <span class="required">*</span>
                                <span class="info-icon" data-tip="Ejemplo: magic - 140 bpm - E minor - @willieinspired">
                                    <i class="fas fa-info-circle"></i>
                                </span>
                            </label>
                            <input type="text" id="titleInput" class="form-input"
                                placeholder="Ej: magic - 140 bpm - E minor - @willieinspired" maxlength="100">
                            <div class="error-msg" id="titleError">
                                <i class="fas fa-exclamation-circle"></i> El título es requerido
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Descripción</label>
                            <textarea id="descInput" class="form-textarea"
                                placeholder="Describe tu beat, su inspiración y características únicas..."
                                maxlength="1000"></textarea>
                            <div class="char-count"><span id="charCount">0</span>/1000</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ARCHIVOS DEL BEAT -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon"><i class="fas fa-file-audio"></i></div>
                    <h2 class="section-title">Archivos del Beat</h2>
                </div>

                <div class="files-grid">
                    <div class="file-upload-card" id="mp3Card" onclick="document.getElementById('mp3Input').click()">
                        <div class="file-icon"><i class="fas fa-file-audio"></i></div>
                        <div class="file-title">Subir MP3 <span class="required">*</span></div>
                        <div class="file-hint">MP3 (máx. 50MB)</div>
                        <div id="mp3Info"></div>
                        <input type="file" id="mp3Input" style="display: none;" accept=".mp3,audio/mpeg">
                    </div>

                    <div class="file-upload-card" id="wavCard" onclick="document.getElementById('wavInput').click()">
                        <div class="file-icon"><i class="fas fa-file-audio"></i></div>
                        <div class="file-title">Subir WAV</div>
                        <div class="file-hint">WAV (máx. 100MB)</div>
                        <div id="wavInfo"></div>
                        <input type="file" id="wavInput" style="display: none;" accept=".wav,audio/wav,audio/x-wav">
                    </div>

                    <div class="file-upload-card" id="stemsCard"
                        onclick="document.getElementById('stemsInput').click()">
                        <div class="file-icon"><i class="fas fa-folder-open"></i></div>
                        <div class="file-title">Subir STEMS</div>
                        <div class="file-hint">ZIP o RAR (máx. 200MB)</div>
                        <div id="stemsInfo"></div>
                        <input type="file" id="stemsInput" style="display: none;"
                            accept=".zip,.rar,application/zip,application/x-rar-compressed,application/x-zip-compressed">
                    </div>
                </div>

                <div class="error-msg" id="filesError">
                    <i class="fas fa-exclamation-circle"></i> Debes subir al menos el archivo MP3
                </div>
            </div>

            <!-- METADATOS -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon"><i class="fas fa-tags"></i></div>
                    <h2 class="section-title">Metadatos</h2>
                </div>

                <div class="metadata-grid">
                    <div class="form-group autocomplete-wrapper">
                        <label class="form-label">
                            Key (Clave)
                            <span class="info-icon" data-tip="Ejemplo: C# minor, E major">
                                <i class="fas fa-info-circle"></i>
                            </span>
                        </label>
                        <input type="text" id="keyInput" class="form-input" placeholder="Ej: C# minor"
                            autocomplete="off">
                        <div class="autocomplete-dropdown" id="keyDropdown"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            BPM
                            <span class="info-icon" data-tip="Rango: 40-500">
                                <i class="fas fa-info-circle"></i>
                            </span>
                        </label>
                        <input type="number" id="bpmInput" class="form-input" placeholder="140" min="40" max="500">
                        <div class="error-msg" id="bpmError">
                            <i class="fas fa-exclamation-circle"></i> El BPM debe estar entre 40 y 500
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Tags (máx. 3)</label>
                    <div class="multi-select">
                        <div class="select-display" id="tagsDisplay" onclick="toggleTagsInput()">
                            <span class="select-placeholder">Escribe y presiona Enter</span>
                        </div>
                    </div>
                    <input type="text" id="tagsInput" style="display: none;">
                </div>

                <div class="form-group">
                    <label class="form-label">
                        Géneros (máx. 3) <span class="required">*</span>
                    </label>
                    <div class="multi-select">
                        <div class="select-display" id="genresDisplay" onclick="toggleSelect('genres')">
                            <span class="select-placeholder">Selecciona o busca géneros</span>
                        </div>
                        <div class="select-dropdown" id="genresDropdown">
                            <input type="text" class="select-search" id="genresSearch" placeholder="Buscar género...">
                            <div id="genresOptions"></div>
                        </div>
                    </div>
                    <div class="error-msg" id="genresError">
                        <i class="fas fa-exclamation-circle"></i> Selecciona al menos un género
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Mood (máx. 5)</label>
                    <div class="multi-select">
                        <div class="select-display" id="moodDisplay" onclick="toggleSelect('mood')">
                            <span class="select-placeholder">Selecciona o busca mood</span>
                        </div>
                        <div class="select-dropdown" id="moodDropdown">
                            <input type="text" class="select-search" id="moodSearch" placeholder="Buscar mood...">
                            <div id="moodOptions"></div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Instrumentos (máx. 10)</label>
                    <div class="multi-select">
                        <div class="select-display" id="instrumentsDisplay" onclick="toggleSelect('instruments')">
                            <span class="select-placeholder">Selecciona o busca instrumentos</span>
                        </div>
                        <div class="select-dropdown" id="instrumentsDropdown">
                            <input type="text" class="select-search" id="instrumentsSearch"
                                placeholder="Buscar instrumento...">
                            <div id="instrumentsOptions"></div>
                        </div>
                    </div>
                </div>

                <div class="checkbox-field">
                    <input type="checkbox" id="hasSamples">
                    <label class="checkbox-text" for="hasSamples">Este beat contiene loops y/o samples de
                        terceros</label>
                </div>
            </div>

            <!-- MONETIZACIÓN -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon"><i class="fas fa-dollar-sign"></i></div>
                    <h2 class="section-title">Monetización</h2>
                </div>

                <div class="alert alert-warning" id="licenseAlert" style="display: none;">
                    <i class="fas fa-info-circle"></i>
                    Debes activar al menos una licencia o configurar como gratis
                </div>

                <div class="checkbox-field" style="margin-bottom: 28px;">
                    <input type="checkbox" id="freeCheckbox" onchange="toggleFreeMode()">
                    <label class="checkbox-text" for="freeCheckbox"><strong>Ofrecer gratis (requiere correo electrónico
                            del usuario)</strong></label>
                </div>

                <div id="licensesSection">
                    <div class="licenses-list">
                        <div class="license-item active" data-license="basic">
                            <div class="license-toggle" onclick="toggleLicense('basic')"></div>
                            <div class="license-details">
                                <div class="license-name">Licencia Básica</div>
                                <div class="license-desc">MP3 | Uso no comercial</div>
                            </div>
                            <div class="license-pricing">
                                <span class="price-symbol">$</span>
                                <input type="number" id="basicPrice" class="price-input" value="20.00" min="1"
                                    max="10000" step="0.01">
                            </div>
                        </div>

                        <div class="license-item active" data-license="premium">
                            <div class="license-toggle" onclick="toggleLicense('premium')"></div>
                            <div class="license-details">
                                <div class="license-name">Licencia Premium</div>
                                <div class="license-desc">WAV, MP3 | Uso comercial limitado</div>
                            </div>
                            <div class="license-pricing">
                                <span class="price-symbol">$</span>
                                <input type="number" id="premiumPrice" class="price-input" value="40.00" min="1"
                                    max="10000" step="0.01">
                            </div>
                        </div>

                        <div class="license-item active" data-license="stems">
                            <div class="license-toggle" onclick="toggleLicense('stems')"></div>
                            <div class="license-details">
                                <div class="license-name">Licencia Stems</div>
                                <div class="license-desc">Todos los archivos + Stems</div>
                            </div>
                            <div class="license-pricing">
                                <span class="price-symbol">$</span>
                                <input type="number" id="stemsLicensePrice" class="price-input" value="60.00" min="1"
                                    max="10000" step="0.01">
                            </div>
                        </div>

                        <div class="license-item active" data-license="exclusive">
                            <div class="license-toggle" onclick="toggleLicense('exclusive')"></div>
                            <div class="license-details">
                                <div class="license-name">Licencia Exclusiva</div>
                                <div class="license-desc">Derechos exclusivos + Todos los archivos</div>
                            </div>
                            <div class="license-pricing">
                                <span class="price-symbol">$</span>
                                <input type="number" id="exclusivePrice" class="price-input" value="100.00" min="1"
                                    max="10000" step="0.01">
                            </div>
                        </div>
                    </div>

                    <a href="/cuenta/licencias.html" class="manage-licenses">
                        <i class="fas fa-cog"></i> Manejar Licencias
                    </a>

                    <!-- DESCUENTOS -->
                    <div class="discount-section">
                        <label class="form-label" style="margin-bottom: 18px;">Descuentos (Opcional)</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="discountType" value="none" checked
                                    onchange="toggleDiscountConfig()">
                                <span>Sin descuento</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="discountType" value="percentage"
                                    onchange="toggleDiscountConfig()">
                                <span>Porcentaje</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="discountType" value="fixed" onchange="toggleDiscountConfig()">
                                <span>Monto fijo</span>
                            </label>
                        </div>

                        <div id="discountConfig" style="display: none;">
                            <div class="discount-config">
                                <div class="form-group discount-license-field">
                                    <label class="form-label">Aplicar a licencia</label>
                                    <select id="discountLicenseSelect" class="form-select">
                                        <option value="">Seleccionar licencia</option>
                                        <option value="basic">Licencia Básica</option>
                                        <option value="premium">Licencia Premium</option>
                                        <option value="stems">Licencia Stems</option>
                                        <option value="exclusive">Licencia Exclusiva</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Valor del descuento</label>
                                    <input type="number" id="discountValue" class="form-input" placeholder="0" min="0">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Fecha de expiración (opcional)</label>
                                    <input type="date" id="discountExpiry" class="form-input">
                                </div>
                            </div>
                            <div class="error-msg" id="discountError">
                                <i class="fas fa-exclamation-circle"></i> El descuento no puede ser mayor o igual al
                                precio
                            </div>
                        </div>
                    </div>

                    <div class="checkbox-field" style="margin-top: 24px;">
                        <input type="checkbox" id="bulkDiscount" checked>
                        <label class="checkbox-text" for="bulkDiscount">Incluir en ofertas por volumen (se aplica
                            automáticamente)</label>
                    </div>
                </div>
            </div>

            <!-- COLABORADORES -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon"><i class="fas fa-users"></i></div>
                    <h2 class="section-title">Colaboradores</h2>
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    Añade colaboradores y divide las regalías. El total debe sumar 100%
                </div>

                <div class="form-group autocomplete-wrapper">
                    <label class="form-label">Buscar colaborador</label>
                    <input type="text" id="collabSearch" class="form-input" placeholder="Buscar usuario..."
                        autocomplete="off">
                    <div class="autocomplete-dropdown" id="collabDropdown"></div>
                </div>

                <div id="collabList"></div>

                <div class="percentage-remaining" id="percentageDisplay">
                    Tu porcentaje: <strong>100%</strong>
                </div>
            </div>

            <!-- PUBLICACIÓN -->
            <div class="form-section">
                <div class="section-header">
                    <div class="section-icon"><i class="fas fa-calendar-alt"></i></div>
                    <h2 class="section-title">Publicación</h2>
                </div>

                <div class="metadata-grid">
                    <div class="form-group">
                        <label class="form-label">Visibilidad</label>
                        <select id="visibilitySelect" class="form-select">
                            <option value="public">Público</option>
                            <option value="private">Privado</option>
                            <option value="unlisted">No listado</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Fecha de publicación</label>
                        <input type="datetime-local" id="releaseDateInput" class="form-input">
                        <div class="error-msg" id="dateError">
                            <i class="fas fa-exclamation-circle"></i> La fecha debe ser hoy o posterior
                        </div>
                    </div>
                </div>
            </div>

            <!-- BOTONES DE ACCIÓN -->
            <div class="form-actions">
                <a href="../dashboard.html" class="btn btn-back">
                    <i class="fas fa-arrow-left"></i> Regresar
                </a>
                <button type="button" class="btn btn-draft" onclick="saveDraft()">
                    <i class="fas fa-save"></i> Guardar Borrador
                </button>
                <button type="submit" class="btn btn-publish">
                    <i class="fas fa-cloud-upload-alt"></i> Publicar Beat
                </button>
            </div>
        </form>
    </main>

    <script src="beats.js"></script>
</body>

</html>